{"version":3,"sources":["../src/commands/yt/SearchCommand.ts"],"names":[],"mappings":"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","file":"SearchCommand.js","sourcesContent":["import {SlashCommandSubcommandBuilder} from \"@discordjs/builders\";\nimport {CommandInteraction, MessageActionRow, MessageEmbed, MessageSelectMenu} from \"discord.js\";\nimport {google, youtube_v3} from \"googleapis\";\nimport {MessageComponentTypes} from \"discord.js/typings/enums\";\nimport {embed} from \"../../utils/embed\";\nimport {SubCommand} from \"../CommandManager\";\nimport Dict = NodeJS.Dict;\n\nexport const SearchCommand: SubCommand = {\n    definition: new SlashCommandSubcommandBuilder()\n        .setName('search')\n        .setDescription('Search youtube channel')\n        .addStringOption(\n            opt => opt.setName('keyword')\n                .setDescription('Keyword to for searching channel')\n                .setRequired(true)\n        ),\n    async handle(interaction: CommandInteraction){\n        let keyword = interaction.options.getString('keyword');\n        await interaction.reply({embeds: [embed.log(`Searching on \"${keyword}\" on youtube.`)]});\n        let res = await google.youtube('v3').search.list({\n            q: keyword, type: ['channel'], part: ['snippet', 'id'], maxResults: 10\n        });\n        if(res.data.pageInfo.totalResults === 0){\n            await interaction.editReply({embeds: [embed.warn(`No search result for \"${keyword}\" :(`)]});\n            return;\n        }\n        let channels: Dict<youtube_v3.Schema$SearchResult> = {};\n        let menu = new MessageSelectMenu();\n        menu.setCustomId('youtube_search');\n        menu.setPlaceholder('Select a channel to view details');\n        menu.addOptions(\n            res.data.items.map(item => {\n                channels[item.id.channelId] = item;\n                return {\n                    label: item.snippet.title,\n                    description: item.snippet.description.length > 100 ?\n                        item.snippet.description.slice(0, 97) + '...' :\n                        item.snippet.description,\n                    value: item.id.channelId,\n                };\n            })\n        );\n        let msg = await interaction.editReply({\n            embeds: [embed.info(`Search results for \"${keyword}\":`)],\n            components: [new MessageActionRow().setComponents(menu)]\n        });\n        let message = await interaction.channel.messages.fetch(msg.id);\n        let collector = message.createMessageComponentCollector({\n            componentType: MessageComponentTypes.SELECT_MENU, time: 60000\n        });\n        collector.on('collect', async (imenu)=>{\n            let embed = new MessageEmbed();\n            let channel = channels[imenu.values[0]];\n            embed.setColor('GREEN');\n            embed.setTitle(channel.snippet.title);\n            embed.setURL(`https://youtube.com/channel/${channel.id.channelId}`);\n            embed.setThumbnail(channel.snippet.thumbnails.default.url);\n            embed.setDescription(channel.snippet.description);\n            embed.addField('Channel ID', channel.id.channelId);\n            await imenu.reply({embeds: [embed]});\n        });\n        collector.on('end', ()=>{\n            menu.setPlaceholder(\"Expired.\");\n            menu.setDisabled(true);\n            message.edit({\n                content: `Search results for ${keyword}:`,\n                components: [new MessageActionRow().setComponents(menu)]\n            });\n        });\n    }\n}"]}